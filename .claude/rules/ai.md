# AI Rules

Google Gemini、プロンプト、画像生成のルール。

## AI モデル

| 用途 | モデル | 変数名 |
|------|--------|--------|
| 文章生成（メイン） | `gemini-3-pro-preview` | `geminiFlash` |
| 軽量タスク（キャッチコピー等） | `gemini-2.5-flash` | `geminiFlashLite` |
| 画像生成 | `gemini-3-pro-image-preview` | `geminiImageGen` |
| 画像生成（マルチモーダル） | `gemini-3-pro-image-preview` | `geminiImageGenMultimodal` |
| 画像分析 | `gemini-3-pro-preview` (Vision) | `geminiFlash` |

## 文章生成

### 投稿タイプ
| ID | タイプ | ターゲット |
|----|--------|-----------|
| `solution` | 解決タイプ | 全般 |
| `promotion` | 宣伝タイプ | ビジネス層 |
| `tips` | AI活用タイプ | ビジネス層 |
| `showcase` | 実績/事例タイプ | ビジネス層 |
| `useful` | お役立ちタイプ | 全般 |
| `howto` | 使い方タイプ | 全般 |
| `image_read` | 画像読み取りタイプ | 全般 |

### テンプレート構造

#### 解決タイプ (solution)
```
📱 よくある質問
「{question}」

💡 解決方法
① {step1}
② {step2}
③ {step3}

✨ ワンポイント
{tip}

---
📍パソコン・スマホ ほほ笑みラボ（飯田市）
```

#### 宣伝タイプ (promotion)
```
【{headline}】

✅ {pain_point1}
✅ {pain_point2}
✅ {pain_point3}

ほほ笑みラボでは
「体験」で終わらせない
必ず成果物を完成させる
AI実務活用サポートを行っています。

{call_to_action}

---
📍詳細はプロフィールのリンクから
```

#### AI活用タイプ (tips)
```
【{title}】

AIを使うと…
✨ {benefit1}
✨ {benefit2}
✨ {benefit3}

例えば…
{example}

---
📍AIの使い方、もっと知りたい方は
プロフィールのリンクから
```

#### 実績/事例タイプ (showcase)
```
【こんな{deliverable_type}を作りました】

📌 お客様の課題
{challenge}

🛠️ 作ったもの
{solution}

🎯 結果
{result}

---
📍一緒に作りませんか？
無料相談はプロフィールから
```

#### お役立ちタイプ (useful)
```
【{title}】

{topic}を使うと…
✨ {benefit1}
✨ {benefit2}
✨ {benefit3}

例えば…
{example}

---
📍{footer_message}
```

#### 使い方タイプ (howto)
```
【{title}】

{topic}を使うと…
✨ {benefit1}
✨ {benefit2}
✨ {benefit3}

例えば…
{example}

---
{howto_title}

1. {step1}

2. {step2}

3. {step3}

---
📍{footer_message}
```

#### 画像読み取りタイプ (image_read)
```
{main_content}

{key_points}

{call_to_action}

---
📍パソコン・スマホ ほほ笑みラボ（飯田市）
```

### 生成ルール
- 文字数: 200〜400文字
- 絵文字: 適度に使用
- ハッシュタグ: 10個
  - 必須4個: #ほほ笑みラボ #飯田市 #パソコン教室 #スマホ
  - 生成6個: 投稿内容に基づいて自動生成
- **重要**: 入力テキストの内容のみを使用し、情報を捏造しない

## 画像生成

### 画像スタイル
| ID | スタイル | 説明 |
|----|---------|------|
| `manga_male` | マンガ風（男性） | テック・ビジネス系、鮮やかな配色 |
| `manga_female` | マンガ風（女性） | クリエイティブ系、パステル調 |
| `pixel_art` | ピクセルアート | レトロゲーム風、サイバー背景 |
| `illustration` | イラスト（人物なし） | フラットデザイン、図形のみ |
| `realistic` | リアル（写真風） | 写真のようなリアルな画像 |

### 背景タイプ
| ID | タイプ | 説明 |
|----|--------|------|
| `tech` | テクノロジー背景 | PC、AI、デジタル要素を含む |
| `auto` | 内容に合わせる | シーン説明から自動判定 |

### アスペクト比
| 形式 | 比率 | サイズ | 用途 |
|------|------|--------|------|
| フィード | 1:1 | 1080×1080 | 通常投稿 |
| リール | 9:16 | 1080×1920 | ショート動画 |

### デフォルトキャラクター
キャラクターが登録されていない場合のデフォルト:
| スタイル | デフォルト |
|---------|----------|
| manga_male | 30-40代の親しみやすい男性、カジュアルビジネススタイル |
| manga_female | 20-30代の明るい雰囲気の女性、スマートカジュアルスタイル |
| pixel_art | かわいいちびキャラ |

### ベースプロンプト

**注意**: 背景の指示は `backgroundType` 設定により変化:
- `tech`: PC、AI、テクノロジー要素を含む背景
- `auto`: シーン説明の内容に合わせた背景

#### マンガ風（男性）- manga_male
```
縦長のショート動画用画像（9:16アスペクト比）。
日本のマンガ・アニメ調のイラストスタイル。
テック系・ビジネス系のサムネイル画像。
鮮やかでカラフルな配色、グラデーション背景。
プロフェッショナルだけど親しみやすい雰囲気。
テキストや文字は含めない、ビジュアルのみ。
メインの人物キャラクター（{character_description}）を中央に配置。
背景にはPC、コード、AI、テクノロジー要素を含める。
シーン: {scene_description}
```

#### マンガ風（女性）- manga_female
```
縦長のショート動画用画像（9:16アスペクト比）。
日本のマンガ・アニメ調のイラストスタイル。
クリエイティブ系・スタートアップ系のサムネイル画像。
パステル調やソフトなグラデーション背景。
スタイリッシュでトレンド感のある雰囲気。
テキストや文字は含めない、ビジュアルのみ。
メインの人物キャラクター（{character_description}）を中央に配置。
背景にはPC、デザイン、SNS、クリエイティブ要素を含める。
シーン: {scene_description}
```

#### ピクセルアート - pixel_art
```
縦長のショート動画用画像（9:16アスペクト比）。
ピクセルアート・ドット絵スタイル。
レトロゲーム風のかわいいちびキャラクター。
サイバー・デジタルな背景、青いネオングリッド。
8bit/16bitゲームの雰囲気。
テキストや文字は含めない、ビジュアルのみ。
メインのピクセルキャラクター（{character_description}）を中央に配置。
背景にはデジタル空間、グリッド、テクノロジー要素を含める。
シーン: {scene_description}
```

#### イラスト風（人物なし）- illustration
```
縦長のショート動画用画像（9:16アスペクト比）。
フラットデザインのイラスト風、ポップで明るい色使い。
テキストは含めない、ビジュアルのみ。
シンプルでかわいらしい雰囲気、2Dイラストスタイル。
人物、キャラクター、顔、手、体は絶対に含めないでください。
アイコン、シンボル、抽象的な図形、風景イラストのみで表現。
テーマ: {theme_description}
```

## キャッチコピー生成

投稿内容から画像に表示するキャッチコピーを生成:
```
以下の投稿内容から、画像に入れるキャッチコピーを1つ生成してください。

条件:
- 10〜20文字程度の短いフレーズ
- 見た人の興味を引く、インパクトのある表現
- 疑問形や「〜しませんか？」「〜できる！」などの形式も可
- 絵文字は使わない
- 日本語で出力

投稿内容:
{caption}

キャッチコピーのみを出力してください（説明や補足は不要）:
```

### キャッチコピー表示
- 全ての画像スタイルでキャッチコピーを画像内に表示
- 確認画面でユーザーが編集・再生成可能
- 30文字以内の制限

## キャラクター機能

### 特徴抽出項目
| 項目 | 例 |
|------|-----|
| 年代 | 30-40代 |
| 性別 | 男性 |
| 髪型 | 短髪、黒髪 |
| 服装 | スーツ（紺）、白シャツ |
| 表情 | 親しみやすい笑顔 |
| スタイル | 似顔絵イラスト風 |
| その他 | 眼鏡の有無など |

### 特徴抽出プロンプト
```
この画像のキャラクターの特徴を抽出してください。
以下の項目で日本語で回答してください：

- 推定年代
- 性別
- 髪型・髪色
- 服装
- 表情・雰囲気
- イラストスタイル
- その他の特徴

回答は簡潔に、画像生成プロンプトで使える形式で。
```

### 画像生成フロー
```
1. 投稿文を生成
2. キャッチコピーを生成（確認画面で編集可能）
3. キャラクターの特徴テキストを取得（未登録ならデフォルト使用）
4. 投稿内容からシーン説明を生成
5. スタイル別ベースプロンプト + キャッチコピーで画像生成
6. Supabase Storage に保存
```

### マルチモーダル画像生成
- `useCharacterImage` オプションで有効化
- キャラクター画像を参照して一貫性のある画像を生成
- 同じ `gemini-3-pro-image-preview` モデルを使用

## シーン説明生成

投稿内容からシーン説明を生成するプロンプト:
```
以下の投稿内容から、画像のシーン説明を生成してください。
30-50文字程度で、具体的なビジュアルをイメージできる説明にしてください。
日本語で出力してください。シーンの説明のみ出力し、余計な説明は不要です。

投稿タイプ: {postType}
投稿内容:
{caption}

出力例:
- スマートフォンを操作する手と、画面に表示されたLINEアイコン
- ノートPCの前で笑顔で説明するビジネスパーソン
- AIアシスタントと会話している様子
```

## API クライアント設定

### Google Gemini
```typescript
import { GoogleGenerativeAI } from '@google/generative-ai'

const genAI = new GoogleGenerativeAI(process.env.GOOGLE_AI_API_KEY!)

// 文章生成（メイン: キャプション、シーン説明、特徴抽出等）
export const geminiFlash = genAI.getGenerativeModel({
  model: 'gemini-3-pro-preview'
})

// 軽量タスク（キャッチコピー生成等、高速レスポンス優先）
export const geminiFlashLite = genAI.getGenerativeModel({
  model: 'gemini-2.5-flash'
})

// 画像生成（テキストのみ）
export const geminiImageGen = genAI.getGenerativeModel({
  model: 'gemini-3-pro-image-preview'
})

// 画像生成（マルチモーダル - キャラクター参照）
export const geminiImageGenMultimodal = genAI.getGenerativeModel({
  model: 'gemini-3-pro-image-preview'
})
```

## パフォーマンス目標

| 項目 | 目標 |
|------|------|
| 文章生成 | 5秒以内 |
| 画像生成 | 30秒以内 |
| 特徴抽出 | 5秒以内 |
