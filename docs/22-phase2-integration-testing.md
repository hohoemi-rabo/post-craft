# チケット #22: Phase 2 統合・テスト

> Phase 2 最終仕上げ
> 優先度: 高
> 参照: SPEC-PHASE2.md セクション 11, 12

---

## 概要

Phase 2 の全機能を統合し、品質確認・テスト・デプロイを行う。
非機能要件の確認と、本番環境での動作確認を実施する。

---

## タスク一覧

### 1. 機能統合確認

#### 認証フロー
- [ ] Google ログインが正常に動作する
- [ ] ホワイトリスト制限が機能する
- [ ] 未認証時のリダイレクトが正常
- [ ] ログアウトが正常に動作する
- [ ] セッション維持が正常

#### 投稿作成フロー
- [ ] Step 1: 投稿タイプ選択が動作する
- [ ] Step 2: メモ書き入力が動作する
- [ ] Step 2: URL 記事抽出が動作する
- [ ] Step 3: 画像スタイル選択が動作する
- [ ] Step 3: アスペクト比選択が動作する
- [ ] Step 3: キャラクター選択が動作する
- [ ] Step 4: 文章生成が動作する
- [ ] Step 4: 画像生成が動作する
- [ ] Step 5: 結果表示が正常
- [ ] Step 5: 編集機能が動作する
- [ ] Step 5: コピー機能が動作する
- [ ] Step 5: ダウンロード機能が動作する
- [ ] Step 5: Instagram 起動が動作する

#### キャラクター管理
- [ ] キャラクター一覧表示が正常
- [ ] キャラクター登録が動作する
- [ ] 画像アップロードが動作する
- [ ] AI 特徴抽出が動作する
- [ ] キャラクター編集が動作する
- [ ] キャラクター削除が動作する
- [ ] デフォルト設定が機能する

#### 投稿履歴
- [ ] 投稿一覧表示が正常
- [ ] ページネーションが動作する
- [ ] 投稿詳細表示が正常
- [ ] 投稿削除が動作する
- [ ] 再利用機能が動作する

### 2. パフォーマンス確認

| 項目 | 目標 | 確認結果 |
|------|------|---------|
| 文章生成 | 5秒以内 | [ ] |
| 画像生成 | 30秒以内 | [ ] |
| ページ読み込み | 3秒以内 | [ ] |
| Lighthouse スコア | 80以上 | [ ] |

### 3. レスポンシブ確認

- [ ] モバイル（iPhone SE サイズ）
- [ ] モバイル（iPhone 14 Pro サイズ）
- [ ] タブレット（iPad サイズ）
- [ ] デスクトップ（1920x1080）
- [ ] ダークモード対応（該当する場合）

### 4. ブラウザ互換性

- [ ] Chrome（最新）
- [ ] Safari（最新）
- [ ] Firefox（最新）
- [ ] Edge（最新）
- [ ] iOS Safari
- [ ] Android Chrome

### 5. エラーハンドリング確認

- [ ] ネットワークエラー時の表示
- [ ] API エラー時のリトライ
- [ ] タイムアウト時の表示
- [ ] バリデーションエラーの表示
- [ ] 認証エラー時のリダイレクト
- [ ] 404 ページの表示
- [ ] 500 エラーページの表示

### 6. セキュリティ確認

- [ ] 認証なしで保護ページにアクセスできない
- [ ] 他ユーザーのデータにアクセスできない
- [ ] RLS が正しく機能している
- [ ] API キーが露出していない
- [ ] CSRF 保護が有効

### 7. 環境変数確認（本番）

```bash
# 認証
GOOGLE_CLIENT_ID=xxx
GOOGLE_CLIENT_SECRET=xxx
NEXTAUTH_SECRET=xxx
NEXTAUTH_URL=https://post-craft-rho.vercel.app

# アクセス制限
ALLOWED_EMAILS=xxx@gmail.com

# Supabase
NEXT_PUBLIC_SUPABASE_URL=xxx
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx
SUPABASE_SERVICE_ROLE_KEY=xxx

# AI
GOOGLE_AI_API_KEY=xxx

# Analytics
NEXT_PUBLIC_GA_ID=xxx
```

### 8. Vercel デプロイ設定

- [ ] 環境変数の設定
- [ ] ビルド成功確認
- [ ] プレビューデプロイでの動作確認
- [ ] 本番デプロイ
- [ ] カスタムドメイン設定（必要に応じて）

### 9. ドキュメント更新

- [ ] CLAUDE.md を Phase 2 に更新
- [ ] README.md の更新（必要に応じて）
- [ ] SPEC-CURRENT.md を Phase 2 完了状態に更新

### 10. 不要コードの整理

- [ ] Phase 1 の未使用コード削除
- [ ] 開発用コンソールログ削除
- [ ] TODO コメントの確認・解消
- [ ] 未使用の依存関係削除

---

## テストシナリオ

### シナリオ 1: 新規ユーザーの初回利用
1. トップページにアクセス
2. ログインボタンをクリック
3. Google アカウントで認証
4. ダッシュボードに遷移
5. 新規投稿作成を開始
6. 解決タイプを選択
7. メモ書きを入力
8. 画像設定を選択
9. 生成を実行
10. 結果を確認・ダウンロード
11. Instagram を開く
12. 履歴に保存されていることを確認

### シナリオ 2: キャラクター登録から投稿作成
1. キャラクター管理ページへ
2. 新規キャラクター登録
3. 画像アップロード
4. AI 特徴抽出
5. キャラクター保存
6. 新規投稿作成
7. キャラクターを選択して画像生成
8. キャラクターが反映された画像を確認

### シナリオ 3: 投稿履歴からの再利用
1. 投稿履歴ページへ
2. 過去の投稿を選択
3. 詳細を確認
4. 「このテンプレートで新規作成」
5. 内容を編集して新規生成
6. 新しい投稿として保存

---

## 完了条件

- [ ] 全機能が正常に動作する
- [ ] パフォーマンス目標を達成している
- [ ] レスポンシブ対応されている
- [ ] 主要ブラウザで動作する
- [ ] エラーハンドリングが適切
- [ ] セキュリティ要件を満たしている
- [ ] 本番環境にデプロイされている
- [ ] ドキュメントが更新されている

---

## Phase 2 完了後の振り返り

### うまくいったこと
- [ ] （実施後に記入）

### 課題・改善点
- [ ] （実施後に記入）

### Phase 3 への申し送り
- [ ] （実施後に記入）

---

## 依存関係

- #13 〜 #21 すべてのチケット

## 後続タスク

- Phase 3 計画（SPEC-PHASE3.md 参照）
