# チケット #37: 統合テスト・コードクリーンアップ

> Phase 3 | 優先度: 高 | 依存: #34, #35, #36

## 概要

Phase 3 全機能の統合テストを実施し、ハードコード参照のクリーンアップ、ドキュメント更新を行う。

## 対象ファイル

| ファイル | 操作 |
|---------|------|
| `src/lib/post-types.ts` | 確認（非推奨マーク検討） |
| `src/lib/templates.ts` | 確認（非推奨マーク検討） |
| `docs/SPEC-CURRENT.md` | 更新（Phase 3 完了状態） |
| `CLAUDE.md` | 更新（投稿タイプDB管理の記載） |
| `.claude/rules/ai.md` | 更新 |
| `.claude/rules/backend.md` | 更新（新APIの記載） |

## 統合テスト項目

### 投稿タイプ管理

- [ ] 一覧表示: 全投稿タイプが表示される
- [ ] 新規作成: 正常に作成できる
- [ ] 新規作成: 上限10個で制限される
- [ ] 編集: 全項目が正常に更新される
- [ ] 削除: 確認モーダル表示 → 削除完了
- [ ] 削除: 使用中投稿がある場合の警告表示
- [ ] 複製: 正常にコピーされる
- [ ] 並び替え: ドラッグ&ドロップで順序変更 → リロード後も維持
- [ ] 有効/無効: 切り替えが反映される

### ハッシュタグ設定

- [ ] 設定表示: 現在の設定が正しく表示される
- [ ] 追加: 新しいハッシュタグを追加できる
- [ ] 削除: ハッシュタグを削除できる
- [ ] 上限: 4個を超えて追加できない
- [ ] 生成連携: 必須数に応じて生成数が調整される

### 投稿作成フロー

- [ ] タイプ選択: DBのタイプが表示される
- [ ] タイプ選択: 無効化タイプが非表示
- [ ] キャプション生成: テンプレートがDB値を反映
- [ ] ハッシュタグ生成: 必須数がDB設定値を反映
- [ ] 投稿保存: `post_type_id` が正しく記録
- [ ] 全投稿タイプで1回ずつ生成テスト

### 履歴

- [ ] 一覧表示: 既存投稿が正常に表示される
- [ ] 詳細表示: タイプ情報がDB値で表示される
- [ ] タイプ変更: モーダルがDB値の一覧を表示
- [ ] フィルタ: タイプ別フィルタが動作する

### データ整合性

- [ ] 全既存投稿に `post_type_id` が設定されている
- [ ] 既存投稿の caption, hashtags, input_text 等が変更されていない
- [ ] Instagram投稿フローが正常に動作する
- [ ] 関連投稿参照機能が正常に動作する

### エッジケース

- [ ] 投稿タイプ0個の状態（全削除後）での投稿作成画面
- [ ] ハッシュタグ0個の状態での生成
- [ ] 削除されたタイプの投稿の履歴表示

## コードクリーンアップ

- [ ] `src/lib/post-types.ts` の直接参照箇所を確認（DB参照に切り替わっているか）
- [ ] `src/lib/templates.ts` の直接参照箇所を確認
- [ ] 不要になった定数にコメントで非推奨マーク（Phase 4 での削除を検討）
- [ ] パフォーマンス確認（API応答時間、ページロード時間）

## ドキュメント更新

- [ ] `docs/SPEC-CURRENT.md` を Phase 3 完了状態に更新
- [ ] `CLAUDE.md` の投稿タイプ関連の記述を更新（DB管理）
- [ ] `.claude/rules/ai.md` のテンプレート関連を更新
- [ ] `.claude/rules/backend.md` に新APIルートを追加
- [ ] `SPEC-PHASE3.md` のステータスを「実装完了」に更新
